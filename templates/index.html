<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Investidor10 API Client</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        #container {
            max-width: 700px;
            margin: auto;
        }


        textarea {
            width: 100%;
            height: 200px;
        }

        input[type="text"] {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
        }

        button {
            margin-right: 5px;
        }

        .section {
            margin-top: 20px;
        }

        .desc {
            font-size: 0.9em;
            color: #555;
        }

        #output {
            border: 1px solid #ddd;
            background: #f9f9f9;
            padding: 10px;
            min-height: 200px;
            white-space: pre-wrap;
        }

        #loading {
            display: none;
            font-style: italic;
            color: #007bff;
        }
    </style>
    <script>
        async function callAPI(endpoint) {
            const urlInput = endpoint === 'wallet-entries' ? 'walletEntriesUrl' : 'walletUrl';
            const url = document.getElementById(urlInput).value.trim();
            if (!url && endpoint !== 'test') {
                alert('Please provide the URL.');
                return;
            }

            if (endpoint !== 'test') {
                // persist URL for future visits
                localStorage.setItem(urlInput, url);
            }

            const params = new URLSearchParams();
            if (endpoint === 'wallet-entries') {
                params.append('wallet_entries_url', url);
            } else if (endpoint !== 'test') {
                params.append('wallet_url', url);
            }

            document.getElementById('loading').style.display = 'block';
            document.getElementById('output').textContent = '';
            try {
                const response = await fetch('/' + endpoint + '?' + params.toString());
                const text = await response.text();
                try {
                    const json = JSON.parse(text);
                    document.getElementById('output').textContent = JSON.stringify(json, null, 2);
                } catch {
                    document.getElementById('output').textContent = text;
                }
            } catch (err) {
                document.getElementById('output').textContent = 'Error: ' + err;
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        // preload stored values on first load
        window.addEventListener('DOMContentLoaded', () => {
            const wallet = localStorage.getItem('walletUrl');
            const entries = localStorage.getItem('walletEntriesUrl');
            if (wallet) document.getElementById('walletUrl').value = wallet;
            if (entries) document.getElementById('walletEntriesUrl').value = entries;
        });
    </script>
</head>
<body>
    <div id="container">
        <h1>Investidor10 API Client</h1>
        <p>Fill in your public wallet URLs and choose an endpoint.</p>

        <div class="section">
            <h3>Wallet URL</h3>
            <input type="text" id="walletUrl" placeholder="Wallet URL">
            <button onclick="callAPI('assets')">/assets</button>
            <button onclick="callAPI('data-com')">/data-com</button>
            <p class="desc">/assets returns the asset tables. /data-com lists upcoming dividend dates.</p>
        </div>

        <div class="section">
            <h3>Wallet Entries URL</h3>
            <input type="text" id="walletEntriesUrl" placeholder="Wallet Entries URL">
            <button onclick="callAPI('wallet-entries')">/wallet-entries</button>
            <p class="desc">/wallet-entries provides your order history.</p>
        </div>

        <div class="section">
            <h3>Misc</h3>
            <button onclick="callAPI('test')">/test</button>
            <p class="desc">Simple health check endpoint.</p>
        </div>

        <div class="section">
            <h3>Results</h3>
            <p id="loading">Loading...</p>
            <pre id="output"></pre>
        </div>
    </div>
</body>
</html>
